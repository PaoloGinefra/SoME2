# Using p5.js in TSX

Here's a list of things to mind when creating a sketch:

- Always use the `SketchRendererNext` component from the `components` folder, and not directly the `SketchRenderer` component
- Always use the `useSketch` (see [Stateless Sketches](#stateless-sketches)) and `useStatefulSketch` ([Stateful Sketches](#stateful-sketches)) hooks

## Stateless sketches

A stateles sketch is a sketch that does not need to access React state.
This does not mean that the sketch cannot hold some state using variabeles declared in the sketch scope.

`useSketch` takes a single parameter:

- a sketch function that takes one parameter: a p5 instance.

```tsx
import SketchRenderer from '../components/SketchRendererNext'
import useSketch from '../hooks/useSketch'

const YourStatelessSketch = () => {
  const sketch = useSketch((p5) => {
    ...
  })

  return <SketchRenderer sketch={sketch} />
}
```

## Stateful sketches

A stateful sketch is a sketch that, in addition to its own state, can access the state of its parent React component.
This is achieved by capturing the state in an object and passing it through a React ref to the sketch.

**NOTE**: trying to access variables outside of the sketch function from inside the sketch function will result in reading stale values.

`useStatefulSketch` takes two parameters:

- an object holding any state variable or component prop that we want to pass into the p5 sketch
- a sketch function that takes two parameters:
  - a React ref that holds the current state
  - a p5 instane

Inside the sketch function you can access the state object through `stateRef.current`

```tsx
import SketchRenderer from '../components/SketchRendererNext'
import useStatefulSketch from '../hooks/useStatefulSketch'

const YourStatefulSketch = ({ prop }) => {
  const [state, setState] = useState(1);
  const sketch = useStatefulSketch({ state, prop }, (stateRef, p5) => {
    ...
    console.log('values', stateRef.current.state, stateRef.current.prop)
    ...
  })

  return <SketchRenderer sketch={sketch} />
}
```

## Sketch functions

Inside a sketch function you have access to the `p5` object.
All p5 functions such as `setup`, `draw`, etc... have to be declared as methods of the `p5` object.
All the global functions that are normally supplied by p5 such as `createCanvas`, `fill`, `rect`, etc... are methods of the `p5` object.

```tsx
return <SketchRenderer
  ...
  sketch={
    (p5) => {
      p5.setup = () => {
        p5.createCanvas(500, 500)
        ...
      }
      p5.draw = () => { ... }
    }
  }
/>
```

Classes need to be imported from `window.p5`, which is only available in the DOM, so do it inside p5 methods.

```tsx
return (
  <SketchRenderer
    sketch={(p5) => {
      p5.setup = () => {
        const { Vector } = window.p5
      }
    }}
  />
)
```

## Examples

Examples can be found here:

- [src/sketches/Example](../src/sketches/Example.tsx)
- [src/sketches/ExampleTimer](../src/sketches/ExampleTimer.tsx)
